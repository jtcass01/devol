<?xml version="1.0"?>

<robot xmlns:xacro="http://wiki.ros.org/xacro">
    <!-- import macros -->
    <xacro:include filename="$(find a200_description)/urdf/a200.materials.xacro"/>
    <xacro:include filename="$(find a200_description)/urdf/a200.gazebo.xacro"/>
    <xacro:include filename= "$(find realsense2_description)/urdf/_d435.urdf.xacro"/>

    <xacro:macro name="a200" params="namespace:=/a200_0000" >
        <!-- Base link is the center of the robot's bottom plate -->
        <link name="a200_base_link">
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/base_link.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="0 0 0" xyz="0 0 0.061875"/>
            <geometry>
                <box size="0.9874 0.5709 0.12375"/>
            </geometry>
            </collision>
            <collision>
            <origin rpy="0 0 0" xyz="0 0 0.17562499999999998"/>
            <geometry>
                <box size="0.7899200000000001 0.5709 0.10375"/>
            </geometry>
            </collision>
        </link>
        <!-- Spawn A200 chassis -->
        <link name="top_chassis_link">
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/top_chassis.dae"/>
            </geometry>
            </visual>
        </link>
        <!-- Attach chassis to the robot -->
        <joint name="top_chassis_joint" type="fixed">
            <parent link="a200_base_link"/>
            <child link="top_chassis_link"/>
        </joint>
        <!-- Inertial link stores the robot's inertial information -->
        <link name="inertial_link">
            <inertial>
            <mass value="46.034"/>
            <origin xyz="-0.00065 -0.085 0.062"/>
            <inertia ixx="0.6022" ixy="-0.02364" ixz="-0.1197" iyy="1.7386" iyz="-0.001544" izz="2.0296"/>
            </inertial>
        </link>
        <joint name="inertial_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <parent link="a200_base_link"/>
            <child link="inertial_link"/>
        </joint>
        <!-- Front Wheels -->
        <link name="front_left_wheel_link">
            <inertial>
            <mass value="2.637"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="0.02084076477" ixy="0" ixz="0" iyy="0.035939686185" iyz="0" izz="0.02084076477"/>
            </inertial>
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/wheels/outdoor.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.1143" radius="0.1651"/>
            </geometry>
            </collision>
        </link>
        <joint name="front_left_wheel_joint" type="continuous">
            <parent link="a200_base_link"/>
            <child link="front_left_wheel_link"/>
            <origin rpy="0 0 0" xyz="0.256 0.2775 0"/>
            <axis rpy="0 0 0" xyz="0 1 0"/>
        </joint>
        <link name="front_right_wheel_link">
            <inertial>
            <mass value="2.637"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="0.02084076477" ixy="0" ixz="0" iyy="0.035939686185" iyz="0" izz="0.02084076477"/>
            </inertial>
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/wheels/outdoor.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.1143" radius="0.1651"/>
            </geometry>
            </collision>
        </link>
        <joint name="front_right_wheel_joint" type="continuous">
            <parent link="a200_base_link"/>
            <child link="front_right_wheel_link"/>
            <origin rpy="0 0 0" xyz="0.256 -0.2775 0"/>
            <axis rpy="0 0 0" xyz="0 1 0"/>
        </joint>
        <!-- Rear Wheels -->
        <link name="rear_left_wheel_link">
            <inertial>
            <mass value="2.637"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="0.02084076477" ixy="0" ixz="0" iyy="0.035939686185" iyz="0" izz="0.02084076477"/>
            </inertial>
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/wheels/outdoor.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.1143" radius="0.1651"/>
            </geometry>
            </collision>
        </link>
        <joint name="rear_left_wheel_joint" type="continuous">
            <parent link="a200_base_link"/>
            <child link="rear_left_wheel_link"/>
            <origin rpy="0 0 0" xyz="-0.256 0.2775 0"/>
            <axis rpy="0 0 0" xyz="0 1 0"/>
        </joint>
        <link name="rear_right_wheel_link">
            <inertial>
            <mass value="2.637"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="0.02084076477" ixy="0" ixz="0" iyy="0.035939686185" iyz="0" izz="0.02084076477"/>
            </inertial>
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/wheels/outdoor.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="1.570795 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.1143" radius="0.1651"/>
            </geometry>
            </collision>
        </link>
        <joint name="rear_right_wheel_joint" type="continuous">
            <parent link="a200_base_link"/>
            <child link="rear_right_wheel_link"/>
            <origin rpy="0 0 0" xyz="-0.256 -0.2775 0"/>
            <axis rpy="0 0 0" xyz="0 1 0"/>
        </joint>
        <ros2_control name="a200_hardware" type="system">
            <hardware>
            <plugin>gz_ros2_control/GazeboSimSystem</plugin>
            </hardware>
            <joint name="front_left_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-1</param>
                <param name="max">1</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            </joint>
            <joint name="rear_left_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-1</param>
                <param name="max">1</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            </joint>
            <joint name="front_right_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-1</param>
                <param name="max">1</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            </joint>
            <joint name="rear_right_wheel_joint">
            <command_interface name="velocity">
                <param name="min">-1</param>
                <param name="max">1</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            </joint>
        </ros2_control>
        <!-- Front bumper mount -->
        <link name="front_bumper_mount"/>
        <joint name="front_bumper_mount_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0.406 0 0.091"/>
            <parent link="a200_base_link"/>
            <child link="front_bumper_mount"/>
        </joint>
        <!-- Rear bumper mount -->
        <link name="rear_bumper_mount"/>
        <joint name="rear_bumper_mount_joint" type="fixed">
            <origin rpy="0 0 3.14159" xyz="-0.406 0 0.091"/>
            <parent link="a200_base_link"/>
            <child link="rear_bumper_mount"/>
        </joint>
        <!-- Default mount -->
        <link name="default_mount"/>
        <joint name="default_mount_joint" type="fixed">
            <child link="default_mount"/>
            <parent link="a200_base_link"/>
            <origin xyz="0.0 0.0 0.224"/>
        </joint>
        <!-- Base footprint is on the ground under the robot -->
        <link name="base_footprint"/>
        <joint name="base_footprint_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0 0 -0.13228"/>
            <parent link="a200_base_link"/>
            <child link="base_footprint"/>
        </joint>
        <!-- Attachments -->
        <!-- Spawn bumper link -->
        <link name="front_bumper_link">
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/attachments/bumper.dae"/>
            </geometry>
            </visual>
        </link>
        <link name="front_bumper_base_link"/>
        <joint name="front_bumper_base_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="front_bumper_mount"/>
            <child link="front_bumper_base_link"/>
        </joint>
        <!-- Attach bumper -->
        <joint name="front_bumper_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0.075 0 0"/>
            <parent link="front_bumper_base_link"/>
            <child link="front_bumper_link"/>
        </joint>
        <!-- Spawn bumper link -->
        <link name="rear_bumper_link">
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/attachments/bumper.dae"/>
            </geometry>
            </visual>
        </link>
        <link name="rear_bumper_base_link"/>
        <joint name="rear_bumper_base_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="rear_bumper_mount"/>
            <child link="rear_bumper_base_link"/>
        </joint>
        <!-- Attach bumper -->
        <joint name="rear_bumper_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0.075 0 0"/>
            <parent link="rear_bumper_base_link"/>
            <child link="rear_bumper_link"/>
        </joint>
        <!-- Spawn top plate -->
        <link name="top_plate_adjust_link"/>
        <link name="top_plate_link">
            <visual>
            <origin xyz="0 0 0"/>
            <material name="clearpath_dark_grey"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/attachments/pacs_top_plate.stl"/>
            </geometry>
            </visual>
            <collision>
            <material name="clearpath_dark_grey"/>
            <origin rpy="0 0 0" xyz="0 0 0.003175"/>
            <geometry>
                <box size="0.67 0.59 0.00635"/>
            </geometry>
            </collision>
        </link>
        <!-- Attach PACS top plate -->
        <joint name="top_plate_adjust_joint" type="fixed">
            <child link="top_plate_adjust_link"/>
            <parent link="default_mount"/>
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
        </joint>
        <joint name="top_plate_joint" type="fixed">
            <child link="top_plate_link"/>
            <parent link="top_plate_adjust_link"/>
            <origin rpy="0.0 0.0 0.0" xyz="0.04825 0.0 0.0"/>
        </joint>
        <link name="top_plate_mount_d1"/>
        <joint name="top_plate_mount_d1_joint" type="fixed">
            <child link="top_plate_mount_d1"/>
            <parent link="top_plate_link"/>
            <origin xyz="0.28 0.0 0.00635"/>
        </joint>
        <link name="top_plate_mount_ur"/>
        <joint name="top_plate_mount_ur_joint" type="fixed">
            <child link="top_plate_mount_ur"/>
            <parent link="top_plate_link"/>
            <origin xyz="0.12 0.0 0.00635"/>
        </joint>
        <!-- Spawn the sensor arch link -->
        <link name="sensor_arch_link">
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0.3"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/attachments/300_mm_sensor_arch.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="0 0 0" xyz="0 0 0.3"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_platform_description/meshes/a200/attachments/300_mm_sensor_arch.dae"/>
            </geometry>
            </collision>
        </link>
        <link name="sensor_arch_mount"/>
        <!-- Attach the sensor arch to the top plate -->
        <joint name="sensor_arch_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="default_mount"/>
            <child link="sensor_arch_link"/>
        </joint>
        <joint name="sensor_arch_mount_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0 0 0.3"/>
            <parent link="sensor_arch_link"/>
            <child link="sensor_arch_mount"/>
        </joint>
        <!-- Links -->
        <link name="user_bay_cover_link">
            <visual>
            <geometry>
                <box size="0.4 0.4 0.002"/>
            </geometry>
            <material name="clearpath_dark_grey"/>
            </visual>
            <collision>
            <geometry>
                <box size="0.4 0.4 0.002"/>
            </geometry>
            <material name="clearpath_dark_grey"/>
            </collision>
        </link>
        <joint name="user_bay_cover_joint" type="fixed">
            <parent link="top_plate_link"/>
            <child link="user_bay_cover_link"/>
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.00735"/>
        </joint>
        <!-- Mounts -->
        <link name="fath_pivot_0_link">
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_mounts_description/meshes/fath_pivot_mount_base.dae"/>
            </geometry>
            <origin rpy="0 0 1.5707963267948966" xyz="0 0 0"/>
            </visual>
            <collision>
            <geometry>
                <box size="0.025 0.025 0.03"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.015"/>
            </collision>
            <collision>
            <geometry>
                <cylinder length="0.03" radius="0.04"/>
            </geometry>
            <origin rpy="1.5707963267948966 0 0" xyz="0 -0.035 0.0225"/>
            </collision>
        </link>
        <link name="fath_pivot_0_hinge_link">
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_mounts_description/meshes/fath_pivot_mount.dae"/>
            </geometry>
            <origin rpy="0 0 1.5707963267948966" xyz="0 0 0"/>
            </visual>
            <collision>
            <geometry>
                <box size="0.025 0.025 0.03"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.015"/>
            </collision>
        </link>
        <link name="fath_pivot_0_mount"/>
        <joint name="fath_pivot_0_joint" type="fixed">
            <parent link="sensor_arch_mount"/>
            <child link="fath_pivot_0_link"/>
            <origin rpy="3.1415 0.0 0.0" xyz="0.0 0.0 -0.021"/>
        </joint>
        <joint name="fath_pivot_0_hinge_joint" type="fixed">
            <parent link="fath_pivot_0_link"/>
            <child link="fath_pivot_0_hinge_link"/>
            <origin rpy="0 0.0 0" xyz="0 0 0.0225"/>
        </joint>
        <joint name="fath_pivot_0_mount_joint" type="fixed">
            <parent link="fath_pivot_0_hinge_link"/>
            <child link="fath_pivot_0_mount"/>
            <origin rpy="0 0 0" xyz="0 0 0.0225"/>
        </joint>
        <link name="bracket_0_link">
            <visual>
            <material name="clearpath_dark_grey"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_mounts_description/meshes/pacs/bracket_horizontal.stl"/>
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0.010125"/>
            </visual>
            <collision>
            <origin rpy="0 0 0" xyz="0 0 0.0050625"/>
            <geometry>
                <box size="0.09 0.09 0.010125"/>
            </geometry>
            </collision>
        </link>
        <link name="bracket_0_mount"/>
        <joint name="bracket_0_joint" type="fixed">
            <child link="bracket_0_link"/>
            <parent link="top_plate_mount_d1"/>
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
        </joint>
        <joint name="bracket_0_mount_joint" type="fixed">
            <child link="bracket_0_mount"/>
            <parent link="bracket_0_link"/>
            <origin rpy="0 0 0" xyz="0 0 0.010125"/>
        </joint>
        <!-- Sensors -->
        <link name="lidar2d_0_link">
            <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <!-- Origin of this mesh is the base of the bracket. -->
                <mesh filename="file:///opt/ros/jazzy/share/clearpath_sensors_description/meshes/hokuyo_ust.stl"/>
            </geometry>
            <material name="clearpath_dark_grey"/>
            </visual>
        </link>
        <link name="lidar2d_0_laser">
            <inertial>
            <mass value="1.1"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="0.00307156543804" ixy="0.0" ixz="0.0" iyy="0.0031284904152700005" iyz="0.0" izz="0.00196432421427"/>
            </inertial>
        </link>
        <joint name="lidar2d_0_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="bracket_0_mount"/>
            <child link="lidar2d_0_link"/>
        </joint>
        <joint name="lidar2d_0_laser_joint" type="fixed">
            <!-- This offset is from the base of the bracket to the LIDAR's focal point. -->
            <origin rpy="0 0 0" xyz="0 0 0.0474"/>
            <parent link="lidar2d_0_link"/>
            <child link="lidar2d_0_laser"/>
        </joint>
        <link name="lidar3d_0_link">
            <inertial>
            <mass value="0.83"/>
            <origin xyz="0 0 0.03585"/>
            <inertia ixx="0.000908059425" ixy="0" ixz="0" iyy="0.000908059425" iyz="0" izz="0.0011049624"/>
            </inertial>
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/velodyne_description/meshes/VLP16_base_1.dae"/>
            </geometry>
            </visual>
            <visual>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/velodyne_description/meshes/VLP16_base_2.dae"/>
            </geometry>
            </visual>
            <collision>
            <origin rpy="0 0 0" xyz="0 0 0.03585"/>
            <geometry>
                <cylinder length="0.0717" radius="0.0516"/>
            </geometry>
            </collision>
        </link>
        <joint name="lidar3d_0_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="sensor_arch_mount"/>
            <child link="lidar3d_0_link"/>
        </joint>
        <link name="lidar3d_0_laser">
            <inertial>
            <mass value="0.01"/>
            <origin xyz="0 0 0"/>
            <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7"/>
            </inertial>
            <visual>
            <origin xyz="0 0 -0.0377"/>
            <geometry>
                <mesh filename="file:///opt/ros/jazzy/share/velodyne_description/meshes/VLP16_scan.dae"/>
            </geometry>
            </visual>
        </link>
        <joint name="lidar3d_0_laser_joint" type="fixed">
            <origin rpy="0 0 0" xyz="0 0 0.0377"/>
            <parent link="lidar3d_0_link"/>
            <child link="lidar3d_0_laser"/>
        </joint>
        <!-- camera body, with origin at bottom screw mount -->
        <joint name="camera_0_joint" type="fixed">
            <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 0.0"/>
            <parent link="fath_pivot_0_mount"/>
            <child link="camera_0_bottom_screw_frame"/>
        </joint>
        <link name="camera_0_bottom_screw_frame"/>

        <xacro:sensor_d435 parent="camera_0_bottom_screw_frame" name="rear_camera" use_nominal_extrinsics="true">
            <origin rpy="3.14159 0 3.14159" xyz="0 0 0.022"/>
        </xacro:sensor_d435>

        <xacro:a200_gazebo namespace="${namespace}"/>

    </xacro:macro>
</robot>
